<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CRUD Vendas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body class="bg-light">

<div class="container mt-5">
  <h1 class="mb-4">Cadastro de Vendas</h1>

  <!-- Formulário de Venda -->
  <div class="card mb-4">
    <div class="card-header">Nova Venda</div>
    <div class="card-body">
      <form id="formVenda">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="cliente" class="form-label">Cliente</label>
            <select id="cliente" class="form-select" required>
              <option value="">Selecione o cliente</option>
              <!-- Aqui virão os clientes do back-end -->
              <option value="1">Maria Silva</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="vendedor" class="form-label">Vendedor</label>
            <select id="vendedor" class="form-select" required>
              <option value="">Selecione o vendedor</option>
              <!-- Aqui virão os vendedores -->
              <option value="2">João Mendes</option>
            </select>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-4">
            <label for="forma_pagamento" class="form-label">Forma de Pagamento</label>
            <select id="forma_pagamento" class="form-select" required>
              <option>Dinheiro</option>
              <option>Cartão Débito</option>
              <option>Cartão Crédito</option>
              <option>PIX</option>
              <option>Boleto</option>
              <option>Crediário</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="status" class="form-label">Status</label>
            <select id="status" class="form-select">
              <option>Concluída</option>
              <option>Cancelada</option>
              <option>Orçamento</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="desconto" class="form-label">Desconto (R$)</label>
            <input type="number" step="0.01" class="form-control" id="desconto" value="0">
          </div>
        </div>

        <div class="mb-3">
          <label for="observacoes" class="form-label">Observações</label>
          <textarea class="form-control" id="observacoes" rows="2"></textarea>
        </div>
        <hr>
        <h5>Itens da Venda</h5>
            <div id="itensContainer"></div>
            <button type="button" class="btn btn-secondary mb-3" onclick="adicionarItem()">+ Adicionar Produto</button>
            <input type="hidden" id="total_itens" name="total_itens" value="0">
        <div class="row mt-4" id="secaoCrediario" style="display: none;">
  <h5>Informações do Crediário</h5>
  <div class="col-md-3">
    <label for="qtd_parcelas" class="form-label">Qtd. Parcelas</label>
    <input type="number" id="qtd_parcelas" name="qtd_parcelas" class="form-control" min="1" value="1">
  </div>
  <div class="col-md-3">
    <label for="primeira_parcela" class="form-label">1ª Parcela (vencimento)</label>
    <input type="date" id="primeira_parcela" name="primeira_parcela" class="form-control">
  </div>
</div>

<hr>

<div class="row">
  <h5>Comissão</h5>
  <div class="col-md-3">
    <label class="form-label">Comissão (%)</label>
    <input type="number" id="percentual_comissao" name="percentual_comissao" class="form-control" step="0.1" value="5">
  </div>
  <div class="col-md-3">
    <label class="form-label">Valor da Comissão</label>
    <input type="text" id="valor_comissao" name="valor_comissao" class="form-control" readonly>
  </div>
</div>



        <div class="mb-3">
          <label for="valor_total" class="form-label fw-bold">Valor Total</label>
          <input type="text" class="form-control" id="valor_total" value="0.00" readonly>
        </div>

        <button type="submit" class="btn btn-primary">Salvar Venda</button>
      </form>
    </div>
  </div>
  

  <!-- Lista de Vendas -->
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>Lista de Vendas</span>
      <input type="text" class="form-control w-25" placeholder="Buscar por cliente">
    </div>
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Vendedor</th>
            <th>Valor Total</th>
            <th>Data</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <!-- Aqui entram os dados do back-end -->
          <tr>
            <td>101</td>
            <td>Maria Silva</td>
            <td>João Mendes</td>
            <td>299.90</td>
            <td>03/08/2025</td>
            <td><span class="badge bg-success">Concluída</span></td>
            <td>
              <button class="btn btn-sm btn-warning">Editar</button>
              <button class="btn btn-sm btn-danger">Excluir</button>
            </td>
          </tr>
          
          <!-- ... -->
        </tbody>
      </table>
    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
let contadorItens = 0;

// Produtos simulados — substitua por backend futuramente
const produtos = [
  { id: 1, nome: "Parafuso", preco: 0.50 },
  { id: 2, nome: "Cimento", preco: 25.90 },
  { id: 3, nome: "Tinta", preco: 89.99 }
];

function adicionarItem() {
  contadorItens++;
  const container = document.getElementById("itensContainer");

  const linha = document.createElement("div");
  linha.className = "row mb-2 align-items-end";
  linha.id = `item_${contadorItens}`;

  let options = '<option value="">Selecione</option>';
  produtos.forEach(p => {
    options += `<option value="${p.id}" data-preco="${p.preco}">${p.nome}</option>`;
  });

  linha.innerHTML = `
    <div class="col-md-4">
      <label class="form-label">Produto</label>
      <select name="produto_${contadorItens}" class="form-select" onchange="atualizarPreco(this, ${contadorItens})">
        ${options}
      </select>
    </div>
    <div class="col-md-2">
      <label class="form-label">Quantidade</label>
      <input type="number" name="quantidade_${contadorItens}" class="form-control" step="0.01" min="0" value="1" onchange="calcularSubtotal(${contadorItens})">
    </div>
    <div class="col-md-2">
      <label class="form-label">Preço Unitário</label>
      <input type="number" name="preco_unitario_${contadorItens}" class="form-control" step="0.01" readonly>
    </div>
    <div class="col-md-2">
      <label class="form-label">Subtotal</label>
      <input type="number" name="subtotal_${contadorItens}" class="form-control" step="0.01" readonly>
    </div>
    <div class="col-md-2 text-end">
      <button type="button" class="btn btn-danger" onclick="removerItem(${contadorItens})">❌</button>
    </div>
  `;

  container.appendChild(linha);
  document.getElementById("total_itens").value = contadorItens;
}

function atualizarPreco(selectEl, index) {
  const preco = selectEl.selectedOptions[0].dataset.preco;
  document.querySelector(`[name="preco_unitario_${index}"]`).value = preco;
  calcularSubtotal(index);
}

function calcularSubtotal(index) {
  const qtd = parseFloat(document.querySelector(`[name="quantidade_${index}"]`).value) || 0;
  const preco = parseFloat(document.querySelector(`[name="preco_unitario_${index}"]`).value) || 0;
  const subtotal = qtd * preco;
  document.querySelector(`[name="subtotal_${index}"]`).value = subtotal.toFixed(2);
  atualizarTotalGeral();
}

function removerItem(index) {
  const item = document.getElementById(`item_${index}`);
  if (item) item.remove();
  atualizarTotalGeral();
}

function atualizarTotalGeral() {
  let total = 0;
  for (let i = 1; i <= contadorItens; i++) {
    const subtotalEl = document.querySelector(`[name="subtotal_${i}"]`);
    if (subtotalEl) total += parseFloat(subtotalEl.value) || 0;
  }
  document.getElementById("valor_total").value = total.toFixed(2);
}
</script>
<script>
document.getElementById("forma_pagamento").addEventListener("change", function () {
  const valor = this.value;
  document.getElementById("secaoCrediario").style.display = valor === "Crediário" ? "block" : "none";
});

document.getElementById("valor_total").addEventListener("input", calcularComissao);
document.getElementById("percentual_comissao").addEventListener("input", calcularComissao);

function calcularComissao() {
  const total = parseFloat(document.getElementById("valor_total").value) || 0;
  const pct = parseFloat(document.getElementById("percentual_comissao").value) || 0;
  const valor = total * (pct / 100);
  document.getElementById("valor_comissao").value = valor.toFixed(2);
}
</script>
</body>
</html>
